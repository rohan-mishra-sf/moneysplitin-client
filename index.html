<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | MoneySplit.in</title>
    <link rel="stylesheet" href="css/app.css"/>
    <link rel="stylesheet" href="css/bootstrap/bootstrap-responsive.min.css"/>
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <script src="js/Chart.js"></script>
    <script src="js/jquery/jquery-2.0.3.min.js" ></script>
    <script src="js/jquery/jquery.cookie.js" ></script>
    <script src="js/custom.js" ></script>
	<script src="js/facebook/sdk.js" ></script>
    <script src="js/bootstrap.min.js"></script>
</head>
<body class="bg-grey-color">
    <script>
	if(!check_login()){
		window.location = "/moneysplitin-client/login.html";
	}
	
		 $.ajax({
				type: "GET",
				url: "http://moneysplit.in/moneysplitin/events",
				headers: {"sessioncode": $.cookie("fblogin")},
				//data: { first_name: userInfo.first_name,last_name: userInfo.last_name,email: userInfo.email,fb_id: userInfo.id,device_token: ''},
				success: function (res) {
					var obj = jQuery.parseJSON( res );
					var eventhtml = '';
					$("#active-events").html(obj.count);
					console.log(  obj.count );
                                        if(obj.count==0) {
                                            $('#myModal').modal('show');
                                        $('#first_login').html('<h2>Welcome to MoneySplit.in</h2><p>Get started by <a data-target="#myModal" data-toggle="modal" >Adding an Event</a></p>');
                                        }
					$.each( obj.data, function( key, value ) {
						eventhtml += '<tr><td><a href="event-details.html?eid='+value.id+'">'+value.title+'</a></td><td><a href="event-details.html?eid='+value.id+'&addexpense=1">Add Expense</a></td></tr>';
					});
					$("#events-table").html(eventhtml);
					//console.log( eventhtml);
				}
			});
			
			 $.ajax({
				type: "GET",
				url: "http://moneysplit.in/moneysplitin/reports",
				headers: {"sessioncode": $.cookie("fblogin")},
				//data: { first_name: userInfo.first_name,last_name: userInfo.last_name,email: userInfo.email,fb_id: userInfo.id,device_token: ''},
				success: function (res) {
					var obj = jQuery.parseJSON( res );
					$("#iOwe").html(obj.share);
					$("#iReceive").html(obj.paid);
					createPieChart(obj.share, obj.paid);
					 //window.myPie.segments[0].value = obj.share;
					//window.myPie.update();
					
					//window.myPie.segments[1].value = obj.paid;
					//window.myPie.update();
				//	console.log(obj);
                    if(!obj.share || !obj.paid) {
                    $('#first_login').html('<h2>Ah! So you are still to add some Expenses </h2><p>When you do, we can show you a quick summary chart here. Get started by adding expenses to your events now!</p>');
                    }
				}
			});
			
		function createPieChart(iOwe, iReceive){	//alert('kjsadkj');
			
        if(!iOwe || !iReceive)
                            return false;
			
            var pieData = [
                       {
                       value: parseInt(iOwe),
                       color:"#F7464A",
                       highlight: "#FF5A5E",
                       label: "Red"
                       },
                       {
                       value: parseInt(iReceive),
                       color: "#46BFBD",
                       highlight: "#5AD3D1",
                       label: "Green"
                       }
                       ];
						   console.log(pieData);
                           var ctx = document.getElementById("chart-area").getContext("2d");
                           var myPieChart = new Chart(ctx).Pie(pieData);
                     }
    </script>
    <div class="container-fluid">
        <div  class="row">
            <div class="text-center head" id="first_login">
                <h2>Active Events&nbsp;<span id="active-events"></span></h2>
                <div id="canvas-holder">
                    <canvas id="chart-area" class="chart" width="300" height="300"/>
                </div>
                <div class="iOwe"><p>You owe:&nbsp;<span id="iOwe">0</span></p></div>
                <div class="iReceive"><p>Owed to you:&nbsp;<span id="iReceive">0</span></p></div>
            </div>
        </div>
        <div class="row">
            <div class="text-center">
                <div class="table-responsive events-table">
                    <table class="table table-condensed table-striped" id="events-table">
                       
                    </table>
                </div>
            </div>
        </div>

        <div class="active">
            <div class="plus">

            <a href="#"  data-toggle="modal" data-target="#myModal">+</a>
            </div>
        </div>


    </div>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="text-center">
                        <h1>ADD EVENT</h1>
                        <p>
An event is a broad account to which you can add your expenses and split with your Friends. It could be anything like your Apartment Expenses or even a Trip with your buddies!
</p>
                        <input type="text" name="event_title" value="" placeholder="Apartment Expenses, Road Trip, etc." id="event_title">
                    </div>
                </div>
                <div class="modal-footer odal-buttons">
                    <button type="button" class="btn btn-default close-btn" data-dismiss="modal">Dismiss :(</button>
                    <button type="button" class="btn btn-primary" id="Add_Event">Get Started! :)</button>
                </div>
            </div>
        </div>

    </div>
<script>
               $('#Add_Event').click(function(){ 
				   var event_title = $('#event_title').val(); 
				   $.ajax({ type: "POST", url: "http://moneysplit.in/moneysplitin/events", headers: {"sessioncode": $.cookie("fblogin")}, data: { title : event_title}, success: function (res) { location.reload(); } }); 
				   });

</script>
</body>
</html>

